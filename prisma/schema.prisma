generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   String                @id @default(uuid())
  email                String                @unique
  passwordHash         String
  userType             UserType
  googleId             String?               @unique
  appleId              String?               @unique
  googleAccessToken    String? // Token de acceso de Google Calendar
  googleRefreshToken   String? // Refresh token de Google Calendar
  isVerified           Boolean               @default(false)
  language             String                @default("es")
  resetToken           String?               @unique
  resetTokenExpiry     DateTime?
  verificationToken    String?               @unique
  verificationTokenExpiry DateTime?
  // Rol del backoffice (solo para usuarios ADMIN)
  roleId               String?
  role                 Role?                 @relation(fields: [roleId], references: [id], onDelete: SetNull)
  createdAt            DateTime              @default(now())
  updatedAt            DateTime              @updatedAt
  empresa              EmpresaProfile?
  postulante           PostulanteProfile?
  refreshTokens        RefreshToken[]
  sentMessages         Message[]             @relation("SentMessages")
  receivedMessages     Message[]             @relation("ReceivedMessages")
  callsMade            Call[]                @relation("CallsMade")
  callsReceived        Call[]                @relation("CallsReceived")
  videoMeetingsCreated VideoMeeting[]        @relation("VideoMeetingsCreated")
  videoMeetingsInvited VideoMeeting[]        @relation("VideoMeetingsInvited")
  termsAcceptances     UserTermsAcceptance[]
  mediaAssets          MediaAsset[]
  paymentTransactions  PaymentTransaction[]
  pushTokens           PushToken[]
  promotions           UserPromotion[]
  JobPostEntitlement   JobPostEntitlement[]
  reportsMade          Report[]              @relation("ReportsMade")
  reportsReceived      Report[]              @relation("ReportsReceived")
  usersBlocked         BlockedUser[]         @relation("UsersBlocked")
  usersBlockedBy       BlockedUser[]         @relation("UsersBlockedBy")

  @@index([roleId])
}

// Roles del backoffice con permisos granulares
model Role {
  id          String   @id @default(uuid())
  name        String   @unique // Ej: SUPER_ADMIN, MODERADOR, SOPORTE, VIEWER
  displayName String   // Nombre para mostrar: "Super Administrador", "Moderador", etc.
  description String?  // Descripción del rol
  permissions String[] // Array de permisos: ["users:read", "users:write", "jobs:read", ...]
  isSystem    Boolean  @default(false) // Roles del sistema no se pueden eliminar
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  users       User[]
}

model RefreshToken {
  id        String    @id @default(uuid())
  userId    String
  token     String    @unique
  createdAt DateTime  @default(now())
  expiresAt DateTime
  revokedAt DateTime?
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model PostulanteProfile {
  id                      String            @id @default(uuid())
  userId                  String            @unique
  fullName                String
  city                    String?
  country                 String?
  skills                  String[]
  profilePicture          String?
  cvUrl                   String?
  videoUrl                String?
  notificationPreferences Json?
  birthDate               DateTime?
  gender                  String?
  nationality             String?
  maritalStatus           String?
  documentType            String?
  documentNumber          String?
  hasOwnVehicle           Boolean           @default(false)
  hasDriverLicense        Boolean           @default(false)
  phone                   String?
  alternatePhone          String?
  address                 String? // Mantener para compatibilidad
  calle                   String?
  numero                  String?
  piso                    String?
  depto                   String?
  province                String?
  postalCode              String?
  // Professional profile
  searchingFirstJob       Boolean           @default(false)
  resumeTitle             String?
  professionalDescription String?
  employmentStatus        String?
  minimumSalary           Float?
  coverLetter             String? // Carta de presentación por defecto
  additionalInformation   String?
  // ATS-friendly fields
  linkedInUrl             String?
  portfolioUrl            String?
  websiteUrl              String?
  githubUrl               String?
  languages               Json? // Array of {language: string, level: string}
  normalizedSkills        String[] // Skills normalized for ATS parsing
  // Relations
  applications            Application[]
  education               Education[]
  experiences             Experience[]
  certifications          Certification[]
  user                    User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobFavorites            JobFavorite[]
  companyFavorites        CompanyFavorite[]
}

model Experience {
  id              String            @id @default(uuid())
  postulanteId    String
  position        String
  company         String
  startDate       DateTime
  endDate         DateTime?
  isCurrent       Boolean           @default(false)
  experienceLevel ExperienceLevel?
  companyCountry  String?
  jobArea         String?
  companyActivity String?
  description     String?
  peopleInCharge  String?
  postulante      PostulanteProfile @relation(fields: [postulanteId], references: [id], onDelete: Cascade)
}

model Education {
  id           String            @id @default(uuid())
  postulanteId String
  degree       String
  institution  String
  country      String?
  studyArea    String?
  studyType    String?
  status       String?
  startDate    DateTime
  endDate      DateTime?
  isCurrent    Boolean           @default(false)
  description  String?
  gpa          Float? // Grade Point Average for ATS
  honors       String? // Academic honors/distinctions
  postulante   PostulanteProfile @relation(fields: [postulanteId], references: [id], onDelete: Cascade)
}

model Certification {
  id             String            @id @default(uuid())
  postulanteId   String
  name           String
  issuer         String // Certification authority/organization
  issueDate      DateTime
  expirationDate DateTime?
  credentialId   String? // Certification ID/certificate number
  credentialUrl  String? // URL to verify certification
  description    String?
  createdAt      DateTime          @default(now())
  updatedAt      DateTime          @updatedAt
  postulante     PostulanteProfile @relation(fields: [postulanteId], references: [id], onDelete: Cascade)

  @@index([postulanteId])
}

model EmpresaProfile {
  id                          String               @id @default(uuid())
  userId                      String               @unique
  companyName                 String
  razonSocial                 String?
  cuit                        String               @unique
  documento                   String? // Alias para cuit
  email                       String
  phone                       String? // Número de teléfono sin código de país (ej: "2616162278")
  phoneCountryCode            String? // Código de país del teléfono (ej: "+54")
  sitioWeb                    String?
  descripcion                 String?
  sector                      String? // Sector de la empresa (ej: ADMIN_CONTABILIDAD_FINANZAS)
  industria                   String? // Industria de la empresa (ej: CALL_CENTER)
  tamano                      String?
  cantidadEmpleados           String? // Alias para tamano
  condicionFiscal             String?
  contribuyenteIngresosBrutos Boolean              @default(false)
  // Dirección
  calle                       String?
  numero                      String?
  piso                        String?
  depto                       String?
  codigoPostal                String?
  localidad                   String?
  ciudad                      String?
  provincia                   String?
  pais                        String?
  // Contacto
  nombreContacto              String?
  apellidoContacto            String?
  // Encabezados de avisos y beneficios
  encabezadosAvisos           String[] // Array de encabezados que aparecerán en los avisos
  beneficiosEmpresa           String[] // Array de beneficios que aparecerán en los avisos
  // Otros
  logo                        String?
  notificationPreferences     Json? // Preferencias de notificaciones
  user                        User                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobs                        Job[]
  favorites                   CompanyFavorite[]
  subscriptions               Subscription[]
  paymentTransactions         PaymentTransaction[]
}

model Job {
  id                  String               @id @default(uuid())
  empresaId           String
  title               String
  description         String
  requirements        String
  location            String
  city                String?
  state               String?
  jobType             JobType
  workMode            String?
  category            String?
  experienceLevel     ExperienceLevel      @default(JUNIOR)
  status              String               @default("active")
  publishedAt         DateTime             @default(now())
  // Salary fields
  minSalary           Float?
  maxSalary           Float?
  // Additional fields
  benefits            String?
  company             String?
  // Payment fields
  isPaid              Boolean              @default(false)
  paymentOrderId      String?
  paymentAmount       Float?
  paymentCurrency     String?              @default("USD")
  paymentStatus       String? // PENDING, COMPLETED, FAILED, REFUNDED
  paidAt              DateTime?
  // Moderation fields
  moderationStatus    ModerationStatus     @default(PENDING)
  moderationReason    String?
  moderatedBy         String?
  moderatedAt         DateTime?
  autoRejectionReason String?
  applications        Application[]
  empresa             EmpresaProfile       @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  favorites           JobFavorite[]
  entitlements        JobPostEntitlement[]
}

model Application {
  id           String            @id @default(uuid())
  postulanteId String
  jobId        String
  status       ApplicationStatus @default(PENDING)
  appliedAt    DateTime          @default(now())
  coverLetter  String?
  isRead       Boolean           @default(false)
  job          Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  postulante   PostulanteProfile @relation(fields: [postulanteId], references: [id], onDelete: Cascade)

  @@unique([postulanteId, jobId])
}

model JobFavorite {
  id           String            @id @default(uuid())
  postulanteId String
  jobId        String
  createdAt    DateTime          @default(now())
  postulante   PostulanteProfile @relation(fields: [postulanteId], references: [id], onDelete: Cascade)
  job          Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@unique([postulanteId, jobId])
  @@index([postulanteId])
  @@index([jobId])
}

model CompanyFavorite {
  id           String            @id @default(uuid())
  postulanteId String
  empresaId    String
  createdAt    DateTime          @default(now())
  postulante   PostulanteProfile @relation(fields: [postulanteId], references: [id], onDelete: Cascade)
  empresa      EmpresaProfile    @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([postulanteId, empresaId])
  @@index([postulanteId])
  @@index([empresaId])
}

model Message {
  id         String   @id @default(uuid())
  fromUserId String
  toUserId   String
  content    String
  isRead     Boolean  @default(false)
  createdAt  DateTime @default(now())
  fromUser   User     @relation("SentMessages", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser     User     @relation("ReceivedMessages", fields: [toUserId], references: [id], onDelete: Cascade)
  reports    Report[]
}

enum UserType {
  POSTULANTE
  EMPRESA
  ADMIN
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  ACCEPTED
  REJECTED
  INTERVIEW
}

enum JobType {
  TIEMPO_COMPLETO
  MEDIO_TIEMPO
  REMOTO
  HIBRIDO
  FREELANCE
}

enum ExperienceLevel {
  JUNIOR
  SEMISENIOR
  SENIOR
}

enum ModerationStatus {
  PENDING_PAYMENT
  PENDING
  APPROVED
  REJECTED
  AUTO_REJECTED
}

model Call {
  id         String     @id @default(uuid())
  fromUserId String
  toUserId   String
  callType   CallType   @default(VOICE)
  status     CallStatus @default(PENDING)
  startedAt  DateTime?
  endedAt    DateTime?
  duration   Int? // Duración en segundos
  createdAt  DateTime   @default(now())
  fromUser   User       @relation("CallsMade", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser     User       @relation("CallsReceived", fields: [toUserId], references: [id], onDelete: Cascade)

  @@index([fromUserId])
  @@index([toUserId])
}

enum CallType {
  VOICE // Llamada de voz
  VIDEO // Videollamada
}

enum CallStatus {
  PENDING // Llamada iniciada, esperando respuesta
  ACCEPTED // Llamada aceptada
  REJECTED // Llamada rechazada
  MISSED // Llamada perdida
  ENDED // Llamada finalizada normalmente
  CANCELLED // Llamada cancelada por el llamador
}

model VideoMeeting {
  id            String             @id @default(uuid())
  createdById   String
  invitedUserId String
  title         String?
  description   String?
  scheduledAt   DateTime
  duration      Int? // Duración estimada en minutos
  status        VideoMeetingStatus @default(SCHEDULED)
  meetingUrl    String? // URL de la reunión (si se usa servicio externo)
  // IDs de eventos creados en Google Calendar (si el usuario conectó su cuenta)
  googleEventIdCreator String?
  googleEventIdInvited String?
  callId        String? // ID de la llamada asociada cuando se inicia
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt
  startedAt     DateTime?
  endedAt       DateTime?
  createdBy     User               @relation("VideoMeetingsCreated", fields: [createdById], references: [id], onDelete: Cascade)
  invitedUser   User               @relation("VideoMeetingsInvited", fields: [invitedUserId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([invitedUserId])
  @@index([scheduledAt])
  @@index([status])
}

enum VideoMeetingStatus {
  SCHEDULED // Reunión agendada
  ACCEPTED // Reunión aceptada por el invitado
  REJECTED // Reunión rechazada por el invitado
  IN_PROGRESS // Reunión en progreso
  COMPLETED // Reunión completada
  CANCELLED // Reunión cancelada
  MISSED // Reunión perdida (no se unió)
}

model Subscription {
  id                   String             @id @default(uuid())
  empresaId            String
  planType             SubscriptionPlan   @default(BASIC)
  status               SubscriptionStatus @default(ACTIVE)
  paypalOrderId        String?
  paypalSubscriptionId String?
  startDate            DateTime           @default(now())
  endDate              DateTime?
  canceledAt           DateTime?
  cancelReason         String?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  empresa              EmpresaProfile     @relation(fields: [empresaId], references: [id], onDelete: Cascade)

  @@unique([empresaId, status])
  @@index([empresaId])
  @@index([status])
}

enum SubscriptionPlan {
  URGENT
  STANDARD
  PREMIUM
  CRYSTAL
  BASIC
  ENTERPRISE
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  EXPIRED
  PENDING
}

enum TermsType {
  POSTULANTE
  EMPRESA
  PRIVACY
  TERMS
}

model TermsAndConditions {
  id              String                @id @default(uuid())
  type            TermsType
  version         String // Versión en formato semántico (ej: "1.0.0", "1.1.0")
  fileUrl         String // URL del PDF almacenado
  markdownContent String? // Contenido del PDF parseado a markdown
  isActive        Boolean               @default(true) // Solo una versión activa por tipo
  description     String? // Descripción de cambios en esta versión
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  acceptances     UserTermsAcceptance[]

  @@unique([type, version])
  @@index([type, isActive])
}

model UserTermsAcceptance {
  id         String             @id @default(uuid())
  userId     String
  termsId    String
  acceptedAt DateTime           @default(now())
  user       User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  terms      TermsAndConditions @relation(fields: [termsId], references: [id], onDelete: Cascade)

  @@unique([userId, termsId])
  @@index([userId])
  @@index([termsId])
}

enum MediaAssetType {
  CV
  AVATAR
  VIDEO
  LOGO
}

enum MediaAssetStatus {
  PENDING
  COMPLETED
  FAILED
}

model MediaAsset {
  id          String           @id @default(uuid())
  ownerUserId String
  type        MediaAssetType
  bucket      String
  key         String           @unique
  mimeType    String
  size        Int // Tamaño en bytes
  status      MediaAssetStatus @default(PENDING)
  metadata    Json? // Metadatos adicionales (ej: datos extraídos de CVs)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  user        User             @relation(fields: [ownerUserId], references: [id], onDelete: Cascade)

  @@index([ownerUserId])
  @@index([type])
  @@index([status])
  @@index([key])
}

enum CatalogType {
  JOB_AREA
  JOB_TYPE
  JOB_LEVEL
  JOB_TYPES
  EXPERIENCE_LEVELS
  APPLICATION_STATUSES
  MODALITIES
  LANGUAGE_LEVELS
  COMPANY_SIZES
  SECTORS
  STUDY_TYPES
  STUDY_STATUSES
  MARITAL_STATUSES
}

enum CatalogLanguage {
  ES
  EN
  PT
}

model Catalog {
  id           String               @id @default(uuid())
  type         CatalogType
  code         String
  isActive     Boolean              @default(true)
  order        Int                  @default(0)
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt
  translations CatalogTranslation[]

  @@unique([type, code])
  @@index([type, order])
  @@index([type, isActive])
}

model CatalogTranslation {
  id        String          @id @default(uuid())
  catalogId String
  lang      CatalogLanguage
  label     String
  catalog   Catalog         @relation(fields: [catalogId], references: [id], onDelete: Cascade)

  @@unique([catalogId, lang])
  @@index([catalogId])
}

model Plan {
  id                     String               @id @default(uuid())
  name                   String               @unique
  code                   String               @unique // Código único para identificar el plan (URGENT, STANDARD, PREMIUM)
  subscriptionPlan       SubscriptionPlan     @default(PREMIUM) // Tipo de suscripción al que pertenece este plan
  price                  Float // Precio del plan
  currency               String               @default("USD") // Moneda del plan (USD para PayPal, ARS para otras pasarelas)
  durationDays           Int // Duración en días desde la publicación
  unlimitedCvs           Boolean              @default(true) // Siempre true según los requisitos
  allowedModifications   Int                  @default(0) // Número de modificaciones permitidas del anuncio
  canModifyCategory      Boolean              @default(false) // Si puede modificar el rubro
  categoryModifications  Int                  @default(0) // Número de veces que puede modificar el rubro (0 o 1)
  hasFeaturedOption      Boolean              @default(false) // Si tiene opción gráfica destacada
  hasAIFeature           Boolean              @default(false) // Si tiene acceso a funcionalidades de IA (generación de descripciones)
  launchBenefitAvailable Boolean              @default(false) // Si tiene beneficio de lanzamiento disponible
  launchBenefitDuration  Int? // Duración del beneficio de lanzamiento en días (4 días)
  isActive               Boolean              @default(true)
  order                  Int                  @default(0)
  description            String? // Descripción del plan
  createdAt              DateTime             @default(now())
  updatedAt              DateTime             @updatedAt
  paymentTransactions    PaymentTransaction[]
  iapProducts            IapProduct[]

  @@index([code])
  @@index([isActive])
  @@index([order])
  @@index([subscriptionPlan])
}

model PaymentTransaction {
  id            String            @id @default(uuid())
  userId        String // Usuario que realizó el pago
  empresaId     String? // Empresa relacionada (si es pago de plan)
  orderId       String            @unique // PayPal Order ID
  amount        Float // Monto del pago
  currency      String            @default("USD") // Moneda
  status        PaymentStatus     @default(PENDING) // Estado del pago
  paymentMethod PaymentMethod     @default(PAYPAL) // Método de pago
  description   String? // Descripción del pago
  planType      SubscriptionPlan? // Tipo de plan (si aplica)
  planId        String? // ID del plan comprado
  plan          Plan?             @relation(fields: [planId], references: [id], onDelete: SetNull)
  paypalData    Json? // Datos adicionales de PayPal (capture response)
  failureReason String? // Razón del fallo (si aplica)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  empresa       EmpresaProfile?   @relation(fields: [empresaId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([empresaId])
  @@index([orderId])
  @@index([status])
  @@index([createdAt])
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum PaymentMethod {
  PAYPAL
  MERCADOPAGO
  STRIPE
  APPLE_IAP
  GOOGLE_PLAY
}

// Push Notifications
model PushToken {
  id        String   @id @default(uuid())
  userId    String
  token     String   @unique
  platform  String // 'ios' | 'android' | 'web'
  deviceId  String? // Identificador del dispositivo
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([isActive])
}

// Definición de promociones disponibles
model Promotion {
  id          String    @id @default(uuid())
  code        String    @unique // e.g. 'LAUNCH_TRIAL_4D'
  title       String    // Título a mostrar
  description String    // Descripción de la promoción
  durationDays Int      // Duración en días
  isActive    Boolean   @default(true)
  startAt     DateTime? // Fecha de inicio de la promoción
  endAt       DateTime? // Fecha de fin de la promoción
  metadata    Json?     // Datos adicionales (iconos, colores, etc.)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([code])
  @@index([isActive])
}

// Promociones reclamadas por usuarios
model UserPromotion {
  id        String          @id @default(uuid())
  userId    String
  promoKey  String // e.g. 'LAUNCH_TRIAL_4D'
  status    PromotionStatus @default(AVAILABLE)
  claimedAt DateTime?
  usedAt    DateTime?
  metadata  Json? // ip, userAgent, companyId, etc.
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, promoKey])
  @@index([userId])
  @@index([promoKey])
  @@index([status])
}

enum PromotionStatus {
  AVAILABLE
  CLAIMED
  USED
  EXPIRED
}

// Entitlements por job post
model JobPostEntitlement {
  id                    String            @id @default(uuid())
  userId                String // Usuario que compró
  jobPostId             String
  source                EntitlementSource
  planKey               String // e.g. 'LAUNCH_TRIAL', 'URGENT', 'STANDARD', 'CRYSTAL'
  expiresAt             DateTime // Hora reloj
  status                EntitlementStatus @default(ACTIVE)
  maxEdits              Int               @default(0)
  editsUsed             Int               @default(0)
  allowCategoryChange   Boolean           @default(false)
  maxCategoryChanges    Int               @default(0)
  categoryChangesUsed   Int               @default(0)
  transactionId         String? // Transaction ID único de Apple/Google
  originalTransactionId String? // Original transaction ID (Apple) o orderId (Google)
  rawPayload            Json? // Datos adicionales (signedTransactionInfo, purchaseToken, etc.)
  createdAt             DateTime          @default(now())
  updatedAt             DateTime          @updatedAt
  job                   Job               @relation(fields: [jobPostId], references: [id], onDelete: Cascade)
  user                  User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([jobPostId])
  // NOTA: transactionId NO es único porque la misma transacción puede usarse para múltiples publicaciones
  // La verificación de replay attack se hace manualmente verificando transactionId + jobPostId
  @@index([userId])
  @@index([jobPostId])
  @@index([planKey])
  @@index([status])
  @@index([expiresAt])
  @@index([transactionId])
}

// Productos IAP mapeados a planes
model IapProduct {
  id        String      @id @default(uuid())
  productId String // e.g. 'job_urgent_7d' - NO debe ser único solo, sino combinado con platform
  platform  IapPlatform
  planKey   String // 'URGENT', 'STANDARD', 'CRYSTAL'
  active    Boolean     @default(true)
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  plan      Plan        @relation(fields: [planKey], references: [code], onDelete: Restrict)

  @@unique([productId, platform]) // La combinación productId + platform debe ser única
  @@index([platform])
  @@index([planKey])
  @@index([active])
  @@index([productId])
}

enum IapPlatform {
  IOS
  ANDROID
}

enum EntitlementSource {
  APPLE_IAP
  GOOGLE_PLAY
  PROMO
  MANUAL
}

enum EntitlementStatus {
  ACTIVE
  EXPIRED
  REVOKED
  REFUNDED
}

model Report {
  id          String        @id @default(uuid())
  reporterId  String // Usuario que hace la denuncia
  reportedId  String // Usuario denunciado
  messageId   String? // Mensaje denunciado (opcional)
  reason      ReportReason
  description String? // Descripción adicional
  status      ReportStatus  @default(PENDING)
  reviewedBy  String? // ID del admin que revisó
  reviewedAt  DateTime?
  adminNotes  String? // Notas del admin
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  reporter    User          @relation("ReportsMade", fields: [reporterId], references: [id], onDelete: Cascade)
  reported    User          @relation("ReportsReceived", fields: [reportedId], references: [id], onDelete: Cascade)
  message     Message?      @relation(fields: [messageId], references: [id], onDelete: SetNull)

  @@index([reporterId])
  @@index([reportedId])
  @@index([messageId])
  @@index([status])
  @@index([createdAt])
}

enum ReportReason {
  SPAM
  HARASSMENT
  INAPPROPRIATE_CONTENT
  FAKE_PROFILE
  SCAM
  OTHER
}

enum ReportStatus {
  PENDING
  REVIEWED
  RESOLVED
  DISMISSED
}

model BlockedUser {
  id            String   @id @default(uuid())
  blockerUserId String // Usuario que bloquea
  blockedUserId String // Usuario bloqueado
  createdAt     DateTime @default(now())
  blocker       User     @relation("UsersBlocked", fields: [blockerUserId], references: [id], onDelete: Cascade)
  blockedUser   User     @relation("UsersBlockedBy", fields: [blockedUserId], references: [id], onDelete: Cascade)

  @@unique([blockerUserId, blockedUserId])
  @@index([blockerUserId])
  @@index([blockedUserId])
}
